<%
  via_child_resource = Avo::App.get_resource(params[:via_child_resource])
  child_field_id = via_child_resource.class.name.underscore.gsub("_resource", "")
  field_id="#{child_field_id}_#{@resource.class.name.underscore.gsub("_resource", "")}_id"
  turbo_frame_id="has_many_field_show_#{@resource.class.name.underscore.gsub("_resource", "").pluralize}"
  resource_model_name = @resource.class.name.underscore.gsub("_resource", "")
  target = params[:modal_resource] == "sub_modal_resource" ? "sub_modal_resource" : "modal_resource"
%>
<turbo-stream action="update" target="<%= target %>">
  <template>
    <script>


      document.dispatchEvent(
        new CustomEvent("resourceCreated", {
          detail: {
            resourceModelName: "<%=resource_model_name%>",
            resourceModelId: "<%=@resource.model.id%>"
          }
        })
      );

      el = document.querySelectorAll("input[type=text][id=<%= field_id %>]")[0]
      if (el) {
        el.setAttribute("value", "<%= @resource.model_title %>")
      }
      el = document.querySelectorAll("input[type=hidden][id=<%= field_id %>]")[0]
      if (el) {
        el.setAttribute("value", "<%=  @resource.model.id %>")
      }
      el = document.querySelectorAll("select[id=<%= field_id %>]")[0]
      if (el) {
        let newOption = new Option('<%= @resource.model_title %>','<%= @resource.model.id %>', true, true);
        el.add(newOption);
      }

      el =  document.getElementById("<%= turbo_frame_id %>")
      if (el) { el.reload() }
    </script>
  </template>
</turbo-stream>